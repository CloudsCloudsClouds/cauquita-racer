[gd_scene load_steps=21 format=3 uid="uid://dgym1luoteeoa"]

[ext_resource type="Material" uid="uid://c77jipoi0a4kb" path="res://assets/materials/rubble.tres" id="1_kmpvh"]
[ext_resource type="Script" uid="uid://c3offhmltwus5" path="res://scripts/raycast_car.gd" id="2_5xha7"]
[ext_resource type="Script" uid="uid://diog0uae3yfq6" path="res://scripts/raycast_wheel.gd" id="3_equcc"]
[ext_resource type="PackedScene" uid="uid://gpbemehwtm61" path="res://scenes/camera_follow_car.tscn" id="4_u8xrd"]

[sub_resource type="ProceduralSkyMaterial" id="ProceduralSkyMaterial_spyxv"]
sky_horizon_color = Color(0.66224277, 0.6717428, 0.6867428, 1)
ground_horizon_color = Color(0.66224277, 0.6717428, 0.6867428, 1)

[sub_resource type="Sky" id="Sky_kmpvh"]
sky_material = SubResource("ProceduralSkyMaterial_spyxv")

[sub_resource type="Environment" id="Environment_5xha7"]
background_mode = 2
sky = SubResource("Sky_kmpvh")
tonemap_mode = 2
glow_enabled = true

[sub_resource type="PlaneMesh" id="PlaneMesh_5xha7"]

[sub_resource type="ConcavePolygonShape3D" id="ConcavePolygonShape3D_equcc"]
data = PackedVector3Array(1, 0, 1, -1, 0, 1, 1, 0, -1, -1, 0, 1, -1, 0, -1, 1, 0, -1)

[sub_resource type="Curve" id="Curve_equcc"]
_data = [Vector2(0, 0.3), 0.0, 0.0, 0, 0, Vector2(0.3, 0.90000004), 0.0, 0.0, 0, 0, Vector2(0.6, 0.8), 0.0, 0.0, 0, 0, Vector2(1, 0.1), 0.0, 0.0, 0, 0]
point_count = 4
metadata/_snap_enabled = true

[sub_resource type="BoxMesh" id="BoxMesh_equcc"]
size = Vector3(2, 0.5, 4)

[sub_resource type="BoxMesh" id="BoxMesh_2lfkc"]
size = Vector3(0.65, 0.4, 1.8)

[sub_resource type="BoxShape3D" id="BoxShape3D_rniql"]
size = Vector3(2, 0.4, 4)

[sub_resource type="Curve" id="Curve_c0mo8"]
_data = [Vector2(0, 1), 0.0, 0.0, 0, 0, Vector2(0.35, 0.35), 0.0, 0.0, 0, 0, Vector2(1, 0.1), 0.0, 0.0, 0, 0]
point_count = 3
metadata/_snap_enabled = true
metadata/_snap_count = 20

[sub_resource type="CylinderMesh" id="CylinderMesh_5xha7"]
top_radius = 0.4
bottom_radius = 0.4
height = 0.15

[sub_resource type="Gradient" id="Gradient_c0mo8"]
offsets = PackedFloat32Array(0.08490566, 0.14150943, 0.990566, 1)
colors = PackedColorArray(0, 0, 0, 1, 0.08490566, 0.08490566, 0.08490566, 1, 0.38841972, 0.317401, 0.7885915, 1, 1, 1, 1, 1)

[sub_resource type="GradientTexture1D" id="GradientTexture1D_u8xrd"]
gradient = SubResource("Gradient_c0mo8")

[sub_resource type="ParticleProcessMaterial" id="ParticleProcessMaterial_khel2"]
gravity = Vector3(0, 0, 0)
color_ramp = SubResource("GradientTexture1D_u8xrd")

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_uvi0d"]
transparency = 1
vertex_color_use_as_albedo = true

[sub_resource type="QuadMesh" id="QuadMesh_jbt3p"]
material = SubResource("StandardMaterial3D_uvi0d")
size = Vector2(0.4, 1)
orientation = 1

[node name="Level1" type="Node3D"]

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_5xha7")

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(0.9999619, -0.0054443073, 0.0068199662, 0, 0.7815205, 0.6238796, -0.008726535, -0.6238558, 0.78149074, 1.394661, 4.3579483, 1.1782451)
shadow_enabled = true

[node name="Plano" type="MeshInstance3D" parent="."]
transform = Transform3D(553.3943, 0, 0, 0, 553.3943, 0, 0, 0, 553.3943, 0, 0, 0)
mesh = SubResource("PlaneMesh_5xha7")

[node name="StaticBody3D" type="StaticBody3D" parent="Plano"]

[node name="CollisionShape3D" type="CollisionShape3D" parent="Plano/StaticBody3D"]
shape = SubResource("ConcavePolygonShape3D_equcc")

[node name="Car" type="RigidBody3D" parent="." node_paths=PackedStringArray("wheels", "skid_marks")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 2.3972344, 0)
mass = 50.0
script = ExtResource("2_5xha7")
wheels = [NodePath("WheelFL"), NodePath("WheelRL"), NodePath("WheelFR"), NodePath("WheelRR")]
acceleration = 800.0
max_speed = 60.0
accel_curve = SubResource("Curve_equcc")
skid_marks = [NodePath("SkidMaks/GPUParticles3D"), NodePath("SkidMaks/GPUParticles3D2"), NodePath("SkidMaks/GPUParticles3D3"), NodePath("SkidMaks/GPUParticles3D4")]

[node name="CarMesh" type="MeshInstance3D" parent="Car"]
material_override = ExtResource("1_kmpvh")
mesh = SubResource("BoxMesh_equcc")

[node name="MeshInstance3D" type="MeshInstance3D" parent="Car/CarMesh"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0.10994494, 0.43921113, 1.0747871)
material_override = ExtResource("1_kmpvh")
mesh = SubResource("BoxMesh_2lfkc")

[node name="CollisionShape3D" type="CollisionShape3D" parent="Car"]
shape = SubResource("BoxShape3D_rniql")

[node name="WheelFL" type="RayCast3D" parent="Car"]
transform = Transform3D(0.99999994, 0, 0, 0, 1, 0, 0, 0, 0.99999994, -1.1, 0, -1.3)
enabled = false
script = ExtResource("3_equcc")
spring_strength = 5000.0
spring_damping = 120.0
over_extend = 0.2
grip_curve = SubResource("Curve_c0mo8")

[node name="Wheel" type="MeshInstance3D" parent="Car/WheelFL"]
transform = Transform3D(-4.371139e-08, -1, 0, 1, -4.371139e-08, 0, 0, 0, 1, 0, -0.1, 0)
mesh = SubResource("CylinderMesh_5xha7")

[node name="WheelRL" type="RayCast3D" parent="Car"]
transform = Transform3D(1.35, 0, 0, 0, 1.35, 0, 0, 0, 1.35, -1.1, 0, 1.3)
enabled = false
script = ExtResource("3_equcc")
spring_strength = 5000.0
spring_damping = 120.0
over_extend = 0.2
wheel_radius = 0.75
is_motor = true
grip_curve = SubResource("Curve_c0mo8")

[node name="Wheel" type="MeshInstance3D" parent="Car/WheelRL"]
transform = Transform3D(-4.371139e-08, -1, 0, 1, -4.371139e-08, 0, 0, 0, 1, 0, -0.1, 0)
mesh = SubResource("CylinderMesh_5xha7")

[node name="WheelFR" type="RayCast3D" parent="Car"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 1.1, 0, -1.3)
enabled = false
script = ExtResource("3_equcc")
spring_strength = 5000.0
spring_damping = 120.0
over_extend = 0.2
grip_curve = SubResource("Curve_c0mo8")

[node name="Wheel" type="MeshInstance3D" parent="Car/WheelFR"]
transform = Transform3D(-4.371139e-08, -1, 0, 1, -4.371139e-08, 0, 0, 0, 1, 0, -0.1, 0)
mesh = SubResource("CylinderMesh_5xha7")

[node name="WheelRR" type="RayCast3D" parent="Car"]
transform = Transform3D(1.35, 0, 0, 0, 1.35, 0, 0, 0, 1.35, 1.1, 0, 1.3)
enabled = false
script = ExtResource("3_equcc")
spring_strength = 5000.0
spring_damping = 120.0
over_extend = 0.2
wheel_radius = 0.75
is_motor = true
grip_curve = SubResource("Curve_c0mo8")

[node name="Wheel" type="MeshInstance3D" parent="Car/WheelRR"]
transform = Transform3D(-4.371139e-08, -1, 0, 1, -4.371139e-08, 0, 0, 0, 1, 0, -0.1, 0)
mesh = SubResource("CylinderMesh_5xha7")

[node name="SkidMaks" type="Node3D" parent="Car"]

[node name="GPUParticles3D" type="GPUParticles3D" parent="Car/SkidMaks"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -3.7507734, 0, 2.7390904)
emitting = false
amount = 150
lifetime = 1.5
fixed_fps = 60
process_material = SubResource("ParticleProcessMaterial_khel2")
draw_pass_1 = SubResource("QuadMesh_jbt3p")

[node name="GPUParticles3D2" type="GPUParticles3D" parent="Car/SkidMaks"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -3.7507734, 0, 2.7390904)
emitting = false
amount = 150
lifetime = 1.5
fixed_fps = 60
process_material = SubResource("ParticleProcessMaterial_khel2")
draw_pass_1 = SubResource("QuadMesh_jbt3p")

[node name="GPUParticles3D3" type="GPUParticles3D" parent="Car/SkidMaks"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -3.7507734, 0, 2.7390904)
emitting = false
amount = 150
lifetime = 1.5
fixed_fps = 60
process_material = SubResource("ParticleProcessMaterial_khel2")
draw_pass_1 = SubResource("QuadMesh_jbt3p")

[node name="GPUParticles3D4" type="GPUParticles3D" parent="Car/SkidMaks"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -3.7507734, 0, 2.7390904)
emitting = false
amount = 150
lifetime = 1.5
fixed_fps = 60
process_material = SubResource("ParticleProcessMaterial_khel2")
draw_pass_1 = SubResource("QuadMesh_jbt3p")

[node name="CameraFollowCar" parent="Car" node_paths=PackedStringArray("objective") instance=ExtResource("4_u8xrd")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.5848842, 4.6067867)
objective = NodePath("..")

[node name="CSGCombiner3D" type="CSGCombiner3D" parent="."]
